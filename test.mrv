#lang marv #/dsl/alpha-parse

x = 1
kev = "kevin"
z = 2

defaults = {
  project = env("MARV_GCP_PROJECT")
  region = env("MARV_GCP_REGION")
}

vpc = gcp:compute.network {
     name = "vpc1"
     description = "vpc1"
     autoCreateSubnetworks = false
     routingConfig = { routingMode = "REGIONAL" }
} <- defaults

sn1 = gcp:compute.subnetwork {
     name = "subnet1"
     description = "primary subnet"
     ipCidrRange =  "10.0.1.0/24" # ival
     region = "europe-west2"
     network = vpc.selfLink
} <- defaults

# 
# network=gcp:compute.network { name = "vpc1" }
# subnet={ region = "europe-west-2"}
# 
# mylist = [ 1 2 3 4 { attr1=123 }]
# 
# for/each (i in [1 2 3]) (j in mylist) {
#  subnet=gcp:compute.subnetwork subnet<-{name=i cidrRange=j}
# }